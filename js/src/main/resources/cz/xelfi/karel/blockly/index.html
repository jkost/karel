<!DOCTYPE html>
<html>
    <head>
        <title>Karel with Blockly</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="#" />

        <script src="blockly_uncompressed.js"></script>
        <script src="js/blocks/karel.js"></script>
        <script src="msg/js/en.js"></script>
    </head>
    <body>
        <button id="x">Dump</button>
        <div id="blocklyDiv" style="height: 720px; width: 800px;"></div>

        <script>
          var workspace = Blockly.karel.inject('blocklyDiv');

          function dump(space, b) {
              console.log(space + b.type + ' call ' + b.getFieldValue("CALL") + ' name ' + b.getFieldValue("NAME"));
              var arr = b.getChildren();
              for (var i = 0; i < arr.length; i++) {
                  var ch = arr[i];
                  if (ch.getSurroundParent() === b) {
                      dump("  " + space, ch);
                  }
                  for (;;) {
                    ch = ch.getNextBlock();
                    if (ch === null) {
                        break;
                    }
                    if (ch.getSurroundParent() === b) {
                        dump("  " + space, ch);
                    }
                  }
              }
          }


          document.getElementById("x").addEventListener('click', function() {
             dump("", Blockly.selected.getRootBlock());
          });
        </script>

    </body>
</html>
